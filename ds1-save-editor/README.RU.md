# Редактор сохранений Dark Souls

Веб-редактор файлов сохранений для Dark Souls 1 (Remastered).

## ⚠️ КРИТИЧЕСКОЕ ОБНОВЛЕНИЕ v1.2.1

**ОБЯЗАТЕЛЬНО выполните перед использованием:**
```bash
npm install
```

Исправлена критическая ошибка в MD5, которая вызывала повреждение сохранений. Подробности в [IMPORTANT.md](IMPORTANT.md).

## Возможности

- **Поиск в папке** - Автоматически ищет .sl2 файлы в выбранной папке (NBGI и т.д.)
- **Автозагрузка** - Автоматически загружает последнее редактированное сохранение
- Загрузка и редактирование файлов сохранений Dark Souls (.sl2)
- Редактирование характеристик (VIT, ATN, END, STR, DEX, RES, INT, FTH)
- Изменение имени персонажа, уровня и человечности
- Автоматический расчёт уровня по характеристикам (опционально)
- **Прямое редактирование файлов** - кнопка Save перезаписывает оригинальный файл (без скачивания!)
- **File System Access API** - современная работа с файлами через системные диалоги
- Компактный двухколоночный интерфейс
- Тёмная тема
- Полностью клиентская работа - сервер не нужен

## Установка

Требуется Node.js (v18 или новее).

```bash
cd ds1-save-editor
npm install
```

## Использование

### Режим разработки

```bash
npm run dev
```

Приложение будет доступно по адресу `http://localhost:5173`

### Сборка для продакшена

```bash
npm run build
```

Файлы будут в папке `dist`.

## Как использовать

### Первый раз - Простой способ (Поиск в папке)
1. Нажмите "Find save in folder" (кнопка с ? подсказкой)
2. Выберите папку: NBGI, DARK SOULS REMASTERED, или любую с сохранениями
3. Приложение рекурсивно найдёт .sl2 файлы
4. Готово! Файл загружен и запомнен

### Первый раз - Вручную
1. Нажмите "Load Save File" (кнопка с ? подсказкой)
2. Перейдите в: `NBGI\DARK SOULS REMASTERED\<user_id>\DRAKS0005.sl2`
3. Выберите файл
4. Файл загрузится и запомнится для следующего раза

### Следующие разы
1. Откройте приложение - последнее сохранение загрузится автоматически!
2. (Может появиться запрос разрешения в первый раз)
3. Сразу начинайте редактирование

### Редактирование
1. Выберите персонажа из списка слева (10 слотов)
2. Редактируйте характеристики:
   - **Левая колонка**: Все 8 характеристик (VIT, ATN, END, STR, DEX, RES, INT, FTH)
   - **Правая колонка**: Имя, Уровень, Человечность
   - **Auto-correct Level**: Включено по умолчанию, автоматически рассчитывает уровень
3. Нажмите **Save** чтобы обновить оригинальный файл
4. Нажмите **Save As** чтобы сохранить в новое место

**Важно:** Всегда делайте резервную копию файла сохранения перед редактированием!

### Совместимость браузеров

**File System Access API** (прямое редактирование файлов):
- ✅ Chrome/Edge 86+
- ✅ Safari 15.2+
- ❌ Firefox (автоматически переключается на скачивание)

Приложение автоматически определяет поддержку и использует fallback если нужно.

## Расположение файлов сохранений

Dark Souls Remastered сохранения обычно находятся:
- Windows: `%USERPROFILE%\Documents\NBGI\DARK SOULS REMASTERED\<user_id>\`

## Технические детали

### Формат файла сохранения
- Шифрование AES-CBC
- Каждый слот персонажа хранится отдельно с уникальным IV (Initialization Vector)
- 11 слотов всего: 10 для персонажей, 1 для настроек (скрыт в UI)
- Имена персонажей хранятся в UTF-16 Little Endian

### Автокоррекция уровня
Когда включена (по умолчанию), уровень рассчитывается как:
```
Уровень = Базовый уровень + (Текущие характеристики - Стартовые характеристики)
```
Каждый класс имеет предопределённые базовые характеристики и стартовый уровень.

### File System Access API
- Использует современные API `showOpenFilePicker()` и `showSaveFilePicker()`
- Требует HTTPS в продакшене (работает на localhost HTTP)
- Автоматически переключается на традиционный input/download если не поддерживается

## Лицензия

Этот проект создан в образовательных целях. Dark Souls является собственностью FromSoftware и Bandai Namco.
